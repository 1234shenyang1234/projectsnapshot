<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¡¹ç›®éšæ‰‹æ‹ - æ¨¡æ¿</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background-color: #1e90ff;
            color: white;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .header h2 {
            font-size: 20px;
            margin: 0;
        }
        
        .template-tabs {
            display: flex;
            overflow-x: auto;
            background-color: #f8f8f8;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .tab-item {
            flex-shrink: 0;
            padding: 12px 16px;
            text-align: center;
            cursor: pointer;
            font-size: 14px;
            color: #666;
            border-bottom: 2px solid transparent;
        }
        
        .tab-item.active {
            color: #1e90ff;
            border-bottom-color: #1e90ff;
        }
        
        .template-content {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
        }
        
        .module-section {
            display: none;
        }
        
        .module-section.active {
            display: block;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .section-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
        }
        
        .btn-primary {
            background-color: #1e90ff;
            color: white;
        }
        
        .btn-secondary {
            background-color: #f0f0f0;
            color: #333;
        }
        
        .btn-danger {
            background-color: #ff4444;
            color: white;
        }
        
        .add-item-form {
            background-color: #f8f8f8;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
        }
        
        .form-row {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .form-input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .item-list {
            margin-bottom: 16px;
        }
        
        .item-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .item-info {
            flex: 1;
            margin-right: 8px;
        }
        
        .item-name {
            font-size: 14px;
            color: #333;
            margin-bottom: 4px;
        }
        
        .item-meta {
            font-size: 12px;
            color: #999;
        }
        
        .item-actions {
            display: flex;
            gap: 8px;
        }
        
        .btn-small {
            padding: 4px 8px;
            font-size: 12px;
        }
        
        .batch-actions {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .import-export-section {
            background-color: #f8f8f8;
            padding: 16px;
            border-radius: 8px;
            margin-top: 24px;
        }
        
        .import-export-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 12px;
        }
        
        .import-export-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .file-input {
            display: none;
        }
        
        .file-label {
            display: inline-block;
            padding: 8px 16px;
            background-color: #1e90ff;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            text-align: center;
        }
        
        /* åº•éƒ¨å¯¼èˆªæ  */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-width: 600px;
            margin: 0 auto;
            background-color: white;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 10px 0;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            color: #666;
            text-decoration: none;
        }
        
        .nav-item.active {
            color: #1e90ff;
        }
        
        .nav-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .nav-text {
            font-size: 12px;
        }
        
        /* é€‰æ‹©æ¨¡å¼æ ·å¼ */
        .item-item.selected {
            background-color: #e6f2ff;
            border-color: #1e90ff;
        }
        
        .checkbox {
            margin-right: 8px;
        }
        
        .select-mode {    
            margin-bottom: 12px;
            padding: 8px;
            background-color: #e6f2ff;
            border-radius: 4px;
            font-size: 14px;
            color: #1e90ff;
        }
        
        /* æç¤ºä¿¡æ¯æ ·å¼ */
        .message {
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 16px;
            font-size: 14px;
        }
        
        .message.success {
            background-color: #d4edda;
            color: #155724;
        }
        
        .message.error {
            background-color: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h2>æ¨¡æ¿</h2>
        </div>
        
        <!-- æ¨¡æ¿ç±»å‹æ ‡ç­¾é¡µ -->
        <div class="template-tabs">
            <div class="tab-item active" data-module="é¡¹ç›®åç§°">é¡¹ç›®åç§°</div>
            <div class="tab-item" data-module="é¡¹ç›®åˆ†ç±»">é¡¹ç›®åˆ†ç±»</div>
            <div class="tab-item" data-module="é¡¹ç›®æ‰€å±ä¹¡é•‡">é¡¹ç›®ä¹¡é•‡</div>
            <div class="tab-item" data-module="ç¼ºé™·ç±»å‹">ç¼ºé™·ç±»å‹</div>
            <div class="tab-item" data-module="é¡¹ç›®çŠ¶æ€">é¡¹ç›®çŠ¶æ€</div>
        </div>
        
        <div class="template-content">
            <!-- é¡¹ç›®åç§°æ¨¡å— -->
            <div class="module-section active" id="é¡¹ç›®åç§°">
                <div id="message_é¡¹ç›®åç§°"></div>
                <div class="select-mode" id="select-mode_é¡¹ç›®åç§°" style="display: none;">
                    <span>é€‰æ‹©æ¨¡å¼</span>
                    <button class="btn btn-danger btn-small" onclick="deleteSelectedItems('é¡¹ç›®åç§°')">åˆ é™¤æ‰€é€‰</button>
                    <button class="btn btn-secondary btn-small" onclick="exitSelectMode('é¡¹ç›®åç§°')">å–æ¶ˆ</button>
                </div>
                <div class="section-header">
                    <h3 class="section-title">é¡¹ç›®åç§°</h3>
                    <div class="action-buttons">
                        <button class="btn btn-secondary" onclick="toggleSelectMode('é¡¹ç›®åç§°')">æ‰¹é‡é€‰æ‹©</button>
                        <button class="btn btn-primary" onclick="toggleAddForm('é¡¹ç›®åç§°')">æ·»åŠ </button>
                    </div>
                </div>
                
                <!-- æ·»åŠ é¡¹ç›®åç§°è¡¨å• -->
                <div class="add-item-form" id="add-form_é¡¹ç›®åç§°" style="display: none;">
                    <div class="form-row">
                        <input type="text" class="form-input" id="new-item-name_é¡¹ç›®åç§°" placeholder="è¯·è¾“å…¥é¡¹ç›®åç§°">
                        <button class="btn btn-primary" onclick="addItem('é¡¹ç›®åç§°')">ä¿å­˜</button>
                        <button class="btn btn-secondary" onclick="toggleAddForm('é¡¹ç›®åç§°')">å–æ¶ˆ</button>
                    </div>
                </div>
                
                <!-- é¡¹ç›®åç§°åˆ—è¡¨ -->
                <div class="item-list" id="item-list_é¡¹ç›®åç§°"></div>
                
                <!-- æ‰¹é‡æ·»åŠ åŒºåŸŸ -->
                <div class="add-item-form">
                    <h4>æ‰¹é‡æ·»åŠ </h4>
                    <div class="form-row">
                        <textarea class="form-input" id="batch-item-names_é¡¹ç›®åç§°" rows="3" placeholder="æ¯è¡Œè¾“å…¥ä¸€ä¸ªé¡¹ç›®åç§°"></textarea>
                    </div>
                    <div class="form-row">
                        <button class="btn btn-primary" onclick="batchAddItems('é¡¹ç›®åç§°')">æ‰¹é‡æ·»åŠ </button>
                    </div>
                </div>
            </div>
            
            <!-- é¡¹ç›®åˆ†ç±»æ¨¡å— -->
            <div class="module-section" id="é¡¹ç›®åˆ†ç±»">
                <div id="message_é¡¹ç›®åˆ†ç±»"></div>
                <div class="select-mode" id="select-mode_é¡¹ç›®åˆ†ç±»" style="display: none;">
                    <span>é€‰æ‹©æ¨¡å¼</span>
                    <button class="btn btn-danger btn-small" onclick="deleteSelectedItems('é¡¹ç›®åˆ†ç±»')">åˆ é™¤æ‰€é€‰</button>
                    <button class="btn btn-secondary btn-small" onclick="exitSelectMode('é¡¹ç›®åˆ†ç±»')">å–æ¶ˆ</button>
                </div>
                <div class="section-header">
                    <h3 class="section-title">é¡¹ç›®åˆ†ç±»</h3>
                    <div class="action-buttons">
                        <button class="btn btn-secondary" onclick="toggleSelectMode('é¡¹ç›®åˆ†ç±»')">æ‰¹é‡é€‰æ‹©</button>
                        <button class="btn btn-primary" onclick="toggleAddForm('é¡¹ç›®åˆ†ç±»')">æ·»åŠ </button>
                    </div>
                </div>
                
                <div class="add-item-form" id="add-form_é¡¹ç›®åˆ†ç±»" style="display: none;">
                    <div class="form-row">
                        <input type="text" class="form-input" id="new-item-name_é¡¹ç›®åˆ†ç±»" placeholder="è¯·è¾“å…¥é¡¹ç›®åˆ†ç±»">
                        <button class="btn btn-primary" onclick="addItem('é¡¹ç›®åˆ†ç±»')">ä¿å­˜</button>
                        <button class="btn btn-secondary" onclick="toggleAddForm('é¡¹ç›®åˆ†ç±»')">å–æ¶ˆ</button>
                    </div>
                </div>
                
                <div class="item-list" id="item-list_é¡¹ç›®åˆ†ç±»"></div>
                
                <div class="add-item-form">
                    <h4>æ‰¹é‡æ·»åŠ </h4>
                    <div class="form-row">
                        <textarea class="form-input" id="batch-item-names_é¡¹ç›®åˆ†ç±»" rows="3" placeholder="æ¯è¡Œè¾“å…¥ä¸€ä¸ªé¡¹ç›®åˆ†ç±»"></textarea>
                    </div>
                    <div class="form-row">
                        <button class="btn btn-primary" onclick="batchAddItems('é¡¹ç›®åˆ†ç±»')">æ‰¹é‡æ·»åŠ </button>
                    </div>
                </div>
            </div>
            
            <!-- é¡¹ç›®æ‰€å±ä¹¡é•‡æ¨¡å— -->
            <div class="module-section" id="é¡¹ç›®æ‰€å±ä¹¡é•‡">
                <div id="message_é¡¹ç›®æ‰€å±ä¹¡é•‡"></div>
                <div class="select-mode" id="select-mode_é¡¹ç›®æ‰€å±ä¹¡é•‡" style="display: none;">
                    <span>é€‰æ‹©æ¨¡å¼</span>
                    <button class="btn btn-danger btn-small" onclick="deleteSelectedItems('é¡¹ç›®æ‰€å±ä¹¡é•‡')">åˆ é™¤æ‰€é€‰</button>
                    <button class="btn btn-secondary btn-small" onclick="exitSelectMode('é¡¹ç›®æ‰€å±ä¹¡é•‡')">å–æ¶ˆ</button>
                </div>
                <div class="section-header">
                    <h3 class="section-title">é¡¹ç›®æ‰€å±ä¹¡é•‡</h3>
                    <div class="action-buttons">
                        <button class="btn btn-secondary" onclick="toggleSelectMode('é¡¹ç›®æ‰€å±ä¹¡é•‡')">æ‰¹é‡é€‰æ‹©</button>
                        <button class="btn btn-primary" onclick="toggleAddForm('é¡¹ç›®æ‰€å±ä¹¡é•‡')">æ·»åŠ </button>
                    </div>
                </div>
                
                <div class="add-item-form" id="add-form_é¡¹ç›®æ‰€å±ä¹¡é•‡" style="display: none;">
                    <div class="form-row">
                        <input type="text" class="form-input" id="new-item-name_é¡¹ç›®æ‰€å±ä¹¡é•‡" placeholder="è¯·è¾“å…¥ä¹¡é•‡åç§°">
                        <button class="btn btn-primary" onclick="addItem('é¡¹ç›®æ‰€å±ä¹¡é•‡')">ä¿å­˜</button>
                        <button class="btn btn-secondary" onclick="toggleAddForm('é¡¹ç›®æ‰€å±ä¹¡é•‡')">å–æ¶ˆ</button>
                    </div>
                </div>
                
                <div class="item-list" id="item-list_é¡¹ç›®æ‰€å±ä¹¡é•‡"></div>
                
                <div class="add-item-form">
                    <h4>æ‰¹é‡æ·»åŠ </h4>
                    <div class="form-row">
                        <textarea class="form-input" id="batch-item-names_é¡¹ç›®æ‰€å±ä¹¡é•‡" rows="3" placeholder="æ¯è¡Œè¾“å…¥ä¸€ä¸ªä¹¡é•‡åç§°"></textarea>
                    </div>
                    <div class="form-row">
                        <button class="btn btn-primary" onclick="batchAddItems('é¡¹ç›®æ‰€å±ä¹¡é•‡')">æ‰¹é‡æ·»åŠ </button>
                    </div>
                </div>
            </div>
            
            <!-- ç¼ºé™·ç±»å‹æ¨¡å— -->
            <div class="module-section" id="ç¼ºé™·ç±»å‹">
                <div id="message_ç¼ºé™·ç±»å‹"></div>
                <div class="select-mode" id="select-mode_ç¼ºé™·ç±»å‹" style="display: none;">
                    <span>é€‰æ‹©æ¨¡å¼</span>
                    <button class="btn btn-danger btn-small" onclick="deleteSelectedItems('ç¼ºé™·ç±»å‹')">åˆ é™¤æ‰€é€‰</button>
                    <button class="btn btn-secondary btn-small" onclick="exitSelectMode('ç¼ºé™·ç±»å‹')">å–æ¶ˆ</button>
                </div>
                <div class="section-header">
                    <h3 class="section-title">ç¼ºé™·ç±»å‹</h3>
                    <div class="action-buttons">
                        <button class="btn btn-secondary" onclick="toggleSelectMode('ç¼ºé™·ç±»å‹')">æ‰¹é‡é€‰æ‹©</button>
                        <button class="btn btn-primary" onclick="toggleAddForm('ç¼ºé™·ç±»å‹')">æ·»åŠ </button>
                    </div>
                </div>
                
                <div class="add-item-form" id="add-form_ç¼ºé™·ç±»å‹" style="display: none;">
                    <div class="form-row">
                        <input type="text" class="form-input" id="new-item-name_ç¼ºé™·ç±»å‹" placeholder="è¯·è¾“å…¥ç¼ºé™·ç±»å‹">
                        <button class="btn btn-primary" onclick="addItem('ç¼ºé™·ç±»å‹')">ä¿å­˜</button>
                        <button class="btn btn-secondary" onclick="toggleAddForm('ç¼ºé™·ç±»å‹')">å–æ¶ˆ</button>
                    </div>
                </div>
                
                <div class="item-list" id="item-list_ç¼ºé™·ç±»å‹"></div>
                
                <div class="add-item-form">
                    <h4>æ‰¹é‡æ·»åŠ </h4>
                    <div class="form-row">
                        <textarea class="form-input" id="batch-item-names_ç¼ºé™·ç±»å‹" rows="3" placeholder="æ¯è¡Œè¾“å…¥ä¸€ä¸ªç¼ºé™·ç±»å‹"></textarea>
                    </div>
                    <div class="form-row">
                        <button class="btn btn-primary" onclick="batchAddItems('ç¼ºé™·ç±»å‹')">æ‰¹é‡æ·»åŠ </button>
                    </div>
                </div>
            </div>
            
            <!-- é¡¹ç›®çŠ¶æ€æ¨¡å— -->
            <div class="module-section" id="é¡¹ç›®çŠ¶æ€">
                <div id="message_é¡¹ç›®çŠ¶æ€"></div>
                <div class="select-mode" id="select-mode_é¡¹ç›®çŠ¶æ€" style="display: none;">
                    <span>é€‰æ‹©æ¨¡å¼</span>
                    <button class="btn btn-danger btn-small" onclick="deleteSelectedItems('é¡¹ç›®çŠ¶æ€')">åˆ é™¤æ‰€é€‰</button>
                    <button class="btn btn-secondary btn-small" onclick="exitSelectMode('é¡¹ç›®çŠ¶æ€')">å–æ¶ˆ</button>
                </div>
                <div class="section-header">
                    <h3 class="section-title">é¡¹ç›®çŠ¶æ€</h3>
                    <div class="action-buttons">
                        <button class="btn btn-secondary" onclick="toggleSelectMode('é¡¹ç›®çŠ¶æ€')">æ‰¹é‡é€‰æ‹©</button>
                        <button class="btn btn-primary" onclick="toggleAddForm('é¡¹ç›®çŠ¶æ€')">æ·»åŠ </button>
                    </div>
                </div>
                
                <div class="add-item-form" id="add-form_é¡¹ç›®çŠ¶æ€" style="display: none;">
                    <div class="form-row">
                        <input type="text" class="form-input" id="new-item-name_é¡¹ç›®çŠ¶æ€" placeholder="è¯·è¾“å…¥é¡¹ç›®çŠ¶æ€">
                        <button class="btn btn-primary" onclick="addItem('é¡¹ç›®çŠ¶æ€')">ä¿å­˜</button>
                        <button class="btn btn-secondary" onclick="toggleAddForm('é¡¹ç›®çŠ¶æ€')">å–æ¶ˆ</button>
                    </div>
                </div>
                
                <div class="item-list" id="item-list_é¡¹ç›®çŠ¶æ€"></div>
                
                <div class="add-item-form">
                    <h4>æ‰¹é‡æ·»åŠ </h4>
                    <div class="form-row">
                        <textarea class="form-input" id="batch-item-names_é¡¹ç›®çŠ¶æ€" rows="3" placeholder="æ¯è¡Œè¾“å…¥ä¸€ä¸ªé¡¹ç›®çŠ¶æ€"></textarea>
                    </div>
                    <div class="form-row">
                        <button class="btn btn-primary" onclick="batchAddItems('é¡¹ç›®çŠ¶æ€')">æ‰¹é‡æ·»åŠ </button>
                    </div>
                </div>
            </div>
            
            <!-- å¯¼å…¥å¯¼å‡ºåŒºåŸŸ -->
            <div class="import-export-section">
                <h3 class="import-export-title">å¯¼å…¥å¯¼å‡º</h3>
                <div class="import-export-actions">
                    <div class="form-row">
                        <label for="import-file" class="file-label">å¯¼å…¥Excel</label>
                        <input type="file" id="import-file" class="file-input" accept=".xlsx, .xls">
                        <button class="btn btn-primary" onclick="importExcel()">ç¡®è®¤å¯¼å…¥</button>
                    </div>
                    <div class="form-row">
                        <button class="btn btn-primary" onclick="exportExcel()">å¯¼å‡ºExcel</button>
                        <button class="btn btn-primary" onclick="downloadTemplate()">ä¸‹è½½æ¨¡æ¿</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- åº•éƒ¨å¯¼èˆªæ  -->
        <div class="bottom-nav">
            <a href="/album" class="nav-item">
                <div class="nav-icon">ğŸ“·</div>
                <div class="nav-text">ç›¸å†Œ</div>
            </a>
            <a href="/camera" class="nav-item">
                <div class="nav-icon">ğŸ“¸</div>
                <div class="nav-text">æ‹ç…§</div>
            </a>
            <a href="/location" class="nav-item">
                <div class="nav-icon">ğŸ“</div>
                <div class="nav-text">å®šä½</div>
            </a>
            <a href="/template" class="nav-item active">
                <div class="nav-icon">ğŸ“‹</div>
                <div class="nav-text">æ¨¡æ¿</div>
            </a>
            <a href="/profile" class="nav-item">
                <div class="nav-icon">ğŸ‘¤</div>
                <div class="nav-text">æˆ‘çš„</div>
            </a>
        </div>
    </div>
    
    <script>
        // å½“å‰é€‰ä¸­çš„æ¨¡å—
        let currentModule = 'é¡¹ç›®åç§°';
        // é€‰æ‹©æ¨¡å¼çŠ¶æ€
        let selectMode = {};
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadItems(currentModule);
            
            // åˆå§‹åŒ–é€‰æ‹©æ¨¡å¼çŠ¶æ€
            const modules = ['é¡¹ç›®åç§°', 'é¡¹ç›®åˆ†ç±»', 'é¡¹ç›®æ‰€å±ä¹¡é•‡', 'ç¼ºé™·ç±»å‹', 'é¡¹ç›®çŠ¶æ€'];
            modules.forEach(module => {
                selectMode[module] = false;
            });
        });
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        document.querySelectorAll('.tab-item').forEach(tab => {
            tab.addEventListener('click', function() {
                const module = this.dataset.module;
                
                // æ›´æ–°æ ‡ç­¾é¡µçŠ¶æ€
                document.querySelectorAll('.tab-item').forEach(item => item.classList.remove('active'));
                this.classList.add('active');
                
                // æ›´æ–°æ¨¡å—å†…å®¹
                document.querySelectorAll('.module-section').forEach(section => {
                    section.classList.remove('active');
                    if (section.id === module) {
                        section.classList.add('active');
                    }
                });
                
                currentModule = module;
                loadItems(module);
            });
        });
        
        // åŠ è½½æ¨¡å—æ¡ç›®
        function loadItems(module) {
            fetch(`/get_module_items?module=${encodeURIComponent(module)}`)    
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById(`item-list_${module}`);
                    container.innerHTML = '';
                    
                    if (data.length === 0) {
                        container.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">æš‚æ— æ•°æ®</div>';
                        return;
                    }
                    
                    data.forEach(item => {
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'item-item';
                        itemDiv.dataset.id = item.id;
                        
                        itemDiv.innerHTML = `
                            <div class="item-info">
                                <div class="item-name">${item.name}</div>
                                <div class="item-meta">åˆ›å»ºæ—¶é—´: ${item.created_at}</div>
                            </div>
                            <div class="item-actions">
                                <button class="btn btn-secondary btn-small" onclick="editItem(${item.id}, '${module}', '${item.name}')">ç¼–è¾‘</button>
                                <button class="btn btn-danger btn-small" onclick="deleteItem(${item.id}, '${module}')">åˆ é™¤</button>
                            </div>
                        `;
                        
                        container.appendChild(itemDiv);
                    });
                })
                .catch(error => {
                    console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                    showMessage(module, 'åŠ è½½æ•°æ®å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
                });
        }
        
        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(module, text, type) {
            const messageDiv = document.getElementById(`message_${module}`);
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = text;
            messageDiv.style.display = 'block';
            
            // 3ç§’åéšè—æ¶ˆæ¯
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 3000);
        }
        
        // åˆ‡æ¢æ·»åŠ è¡¨å•
        function toggleAddForm(module) {
            const form = document.getElementById(`add-form_${module}`);
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
            
            if (form.style.display === 'block') {
                document.getElementById(`new-item-name_${module}`).focus();
            }
        }
        
        // æ·»åŠ æ¡ç›®
        function addItem(module) {
            const nameInput = document.getElementById(`new-item-name_${module}`);
            const name = nameInput.value.trim();
            
            if (!name) {
                showMessage(module, 'è¯·è¾“å…¥æ¡ç›®åç§°', 'error');
                return;
            }
            
            fetch('/save_module_item', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ module: module, name: name })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showMessage(module, 'æ·»åŠ æˆåŠŸ', 'success');
                    nameInput.value = '';
                    toggleAddForm(module);
                    loadItems(module);
                } else {
                    showMessage(module, 'æ·»åŠ å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
                }
            })
            .catch(error => {
                console.error('æ·»åŠ å¤±è´¥:', error);
                showMessage(module, 'æ·»åŠ å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
            });
        }
        
        // ç¼–è¾‘æ¡ç›®
        function editItem(id, module, currentName) {
            const newName = prompt('è¯·è¾“å…¥æ–°çš„åç§°:', currentName);
            if (newName === null) return;
            
            const trimmedName = newName.trim();
            if (!trimmedName) {
                showMessage(module, 'åç§°ä¸èƒ½ä¸ºç©º', 'error');
                return;
            }
            
            if (trimmedName === currentName) return;
            
            fetch('/update_module_item', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ id: id, name: trimmedName })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showMessage(module, 'æ›´æ–°æˆåŠŸ', 'success');
                    loadItems(module);
                } else {
                    showMessage(module, 'æ›´æ–°å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
                }
            })
            .catch(error => {
                console.error('æ›´æ–°å¤±è´¥:', error);
                showMessage(module, 'æ›´æ–°å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
            });
        }
        
        // åˆ é™¤æ¡ç›®
        function deleteItem(id, module) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ¡ç›®å—ï¼Ÿ')) {
                fetch('/delete_module_item', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ id: id })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showMessage(module, 'åˆ é™¤æˆåŠŸ', 'success');
                        loadItems(module);
                    } else {
                        showMessage(module, 'åˆ é™¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
                    }
                })
                .catch(error => {
                    console.error('åˆ é™¤å¤±è´¥:', error);
                    showMessage(module, 'åˆ é™¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
                });
            }
        }
        
        // æ‰¹é‡æ·»åŠ æ¡ç›®
        function batchAddItems(module) {
            const textarea = document.getElementById(`batch-item-names_${module}`);
            const names = textarea.value.trim().split('\n').filter(name => name.trim() !== '');
            
            if (names.length === 0) {
                showMessage(module, 'è¯·è¾“å…¥è‡³å°‘ä¸€ä¸ªæ¡ç›®åç§°', 'error');
                return;
            }
            
            if (names.length > 50) {
                showMessage(module, 'å•æ¬¡æ‰¹é‡æ·»åŠ æœ€å¤š50ä¸ªæ¡ç›®', 'error');
                return;
            }
            
            fetch('/batch_save_module_items', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ module: module, names: names })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showMessage(module, `æˆåŠŸæ·»åŠ  ${data.added} ä¸ªæ¡ç›®`, 'success');
                    textarea.value = '';
                    loadItems(module);
                } else {
                    showMessage(module, 'æ‰¹é‡æ·»åŠ å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
                }
            })
            .catch(error => {
                console.error('æ‰¹é‡æ·»åŠ å¤±è´¥:', error);
                showMessage(module, 'æ‰¹é‡æ·»åŠ å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
            });
        }
        
        // åˆ‡æ¢é€‰æ‹©æ¨¡å¼
        function toggleSelectMode(module) {
            selectMode[module] = !selectMode[module];
            const selectModeDiv = document.getElementById(`select-mode_${module}`);
            selectModeDiv.style.display = selectMode[module] ? 'block' : 'none';
            
            // æ›´æ–°æ¡ç›®æ˜¾ç¤º
            updateItemSelection(module);
        }
        
        // é€€å‡ºé€‰æ‹©æ¨¡å¼
        function exitSelectMode(module) {
            selectMode[module] = false;
            const selectModeDiv = document.getElementById(`select-mode_${module}`);
            selectModeDiv.style.display = 'none';
            
            // æ¸…é™¤æ‰€æœ‰é€‰æ‹©
            document.querySelectorAll(`#item-list_${module} .item-item`).forEach(item => {
                item.classList.remove('selected');
                item.innerHTML = item.innerHTML.replace('<input type="checkbox" class="checkbox" onchange="toggleItemSelection(this)">', '');
            });
        }
        
        // æ›´æ–°æ¡ç›®é€‰æ‹©æ˜¾ç¤º
        function updateItemSelection(module) {
            document.querySelectorAll(`#item-list_${module} .item-item`).forEach(item => {
                if (selectMode[module]) {
                    // æ·»åŠ é€‰æ‹©æ¡†
                    if (!item.innerHTML.includes('checkbox')) {
                        const itemInfo = item.querySelector('.item-info');
                        itemInfo.insertAdjacentHTML('beforebegin', '<input type="checkbox" class="checkbox" onchange="toggleItemSelection(this)">');
                    }
                } else {
                    // ç§»é™¤é€‰æ‹©æ¡†å’Œé€‰ä¸­çŠ¶æ€
                    item.classList.remove('selected');
                    item.innerHTML = item.innerHTML.replace('<input type="checkbox" class="checkbox" onchange="toggleItemSelection(this)">', '');
                }
            });
        }
        
        // åˆ‡æ¢æ¡ç›®é€‰æ‹©çŠ¶æ€
        function toggleItemSelection(checkbox) {
            const itemDiv = checkbox.closest('.item-item');
            if (checkbox.checked) {
                itemDiv.classList.add('selected');
            } else {
                itemDiv.classList.remove('selected');
            }
        }
        
        // åˆ é™¤é€‰ä¸­æ¡ç›®
        function deleteSelectedItems(module) {
            const selectedItems = document.querySelectorAll(`#item-list_${module} .item-item.selected`);
            if (selectedItems.length === 0) {
                showMessage(module, 'è¯·é€‰æ‹©è‡³å°‘ä¸€ä¸ªæ¡ç›®', 'error');
                return;
            }
            
            if (confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${selectedItems.length} ä¸ªæ¡ç›®å—ï¼Ÿ`)) {
                const ids = Array.from(selectedItems).map(item => parseInt(item.dataset.id));
                
                fetch('/batch_delete_module_items', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ ids: ids })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showMessage(module, `æˆåŠŸåˆ é™¤ ${data.deleted} ä¸ªæ¡ç›®`, 'success');
                        exitSelectMode(module);
                        loadItems(module);
                    } else {
                        showMessage(module, 'æ‰¹é‡åˆ é™¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
                    }
                })
                .catch(error => {
                    console.error('æ‰¹é‡åˆ é™¤å¤±è´¥:', error);
                    showMessage(module, 'æ‰¹é‡åˆ é™¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
                });
            }
        }
        
        // å¯¼å…¥Excel
        function importExcel() {
            const fileInput = document.getElementById('import-file');
            if (!fileInput.files.length) {
                alert('è¯·é€‰æ‹©è¦å¯¼å…¥çš„Excelæ–‡ä»¶');
                return;
            }
            
            const file = fileInput.files[0];
            const formData = new FormData();
            formData.append('file', file);
            
            fetch('/import_excel', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(`å¯¼å…¥æˆåŠŸï¼Œå…±å¤„ç† ${data.processed} ä¸ªæ¡ç›®`);
                    fileInput.value = '';
                    loadItems(currentModule);
                } else {
                    alert(`å¯¼å…¥å¤±è´¥: ${data.message}`);
                }
            })
            .catch(error => {
                console.error('å¯¼å…¥å¤±è´¥:', error);
                alert('å¯¼å…¥å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            });
        }
        
        // å¯¼å‡ºExcel
        function exportExcel() {
            window.location.href = '/export_excel';
        }
        
        // ä¸‹è½½æ¨¡æ¿
        function downloadTemplate() {
            window.location.href = '/download_template';
        }
    </script>
</body>
</html>